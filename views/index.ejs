<html>
<head>
	<meta charset="utf-8">
	<!-- CSS only -->
	<link rel="stylesheet" href="/public/style.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
	<!-- JavaScript Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
	<!-- code mirror -->
	<link rel="stylesheet" href="/public/codemirror.css">
	<script src="/public/codemirror.js"></script>
	<script src="/public/modal.js"></script>
</head>
<body>
	<div class="container main-page">
		<h1>New Project</h1>
		<hr>
		<div class="row">
			<div class="col-4">
				<div id="file_name_inner">
				</div>
			</div>
			<div class="col-8">
				<div id="editor_inner">
					<textarea id="editor-textarea">var editor = "test";</textarea>
				</div>
			</div>
		</div>
	</div>
	<div class="modal-content">
	</div>
<script>
	// 
	var all_files_o = "[<%= all_files %>]".replace("[", "").replace("]", "");
	var all_files_original = all_files_o.split(",");
	var all_files = []; var j = 0;
	for(var i = 0; i < all_files_original.length; i ++ ){
		j = i % 4;
		if ( j == 1 ) {
			all_files[all_files.length-1][0] = parseInt(all_files_original[i])
		} else if ( j == 2 ) {
			all_files[all_files.length-1][1] = parseInt(all_files_original[i])
		} else if (j == 3){
			all_files[all_files.length-1][3] = all_files_original[i]
		} else if ( j == 0 ) {
			all_files.push([]);
			all_files[all_files.length-1][2] = all_files_original[i]
		}
	}
	//	
	var file_name_area = document.getElementById("file_name_inner");
	var p_element_inner = "";
	for(var i = 0; i < all_files.length; i++){
		var li_element  = document.createElement("li");
		var a_element   = document.createElement("a");
		a_element_inner =  "ã€€".repeat(all_files[i][0]);
		a_element_inner += all_files[i][3];
		a_element.textContent = a_element_inner;
		if ( all_files[i][1] == 0 ){
			//
			a_element.href  = "http://localhost:3000?file_name=" + all_files[i][2];
		}
		li_element.appendChild(a_element)
		file_name_area.appendChild(li_element)
	}
	//
	var file_content = "<%= file_content -%>";
	file_content = file_content.replaceAll("&lt;br&gt;", "\n");
	document.getElementById("editor-textarea").value = file_content;
</script>
<script>
	// code mirror
	var myTextArea = document.getElementById("editor-textarea");
	var editor = CodeMirror.fromTextArea(document.getElementById("editor-textarea"), {
		mode: "javascript", 
		lineNumbers: true,
	});
	editor.save();
</script>
</body>
</html>